Opérations
##########


* Démarrage du service

En tant qu'utilisateur root : 
``systemctl start vitam-storage``

* Arrêt du service

En tant qu'utilisateur root : 
``systemctl stop vitam-storage``


* Sauvegarde du service

Ce service ne nécessite pas de sauvegarde particulière.

* Supervision du service

Contrôler le retour HTTP 200 sur l'URL ``<protocole web https ou https>://<host>:<port>/storage/v1/status``

Contrôler le retour HTTP 200 sur l'URL ``<protocole web https ou https>://<host>:<port admin>/admin/v1/status``


* Exports

N/A

* gestion de la capacité

N/A

* actions récurrentes

.. logrotate / purge des logs si occupation importante ?

*  cas des batches

N/A

access-log
===========

Le log des accès est généré lors d’un accès à l’objet (fichier numérique), que ce soit par téléchargement de l’objet ou export d’un DIP. Les accès à l’unité archivistique ne sont pas concernés.

Exemple de log généré lors de l’export d’un DIP d’une unité archivistique ayant un GOT contenant un objet ::

   {"eventDateTime":"2019-01-11T12:50:53.344","xRequestId":"aeeaaaaaachfmo4dabyw6aliht3q74aaaaaq","applicationId":"MyApplicationId-ChangeIt","objectIdentifier":"aeaaaaaaaahk2vrsabz26alhywthyoaaaaba","size":"11","qualifier":"BinaryMaster","version":"1","contextId":"CT-000001","contractId":"ContratTNR","archivesId":"aeaqaaaaaahk2vrsabz26alhywthzbaaaaea"}

Structure des logs :

  - "eventDateTime" : date et heure de l’accès au format AAAA-MM-JJTHH:MM:SS.[digits de millisecondes]
  - "xRequestId" : identifiant de l’opération d’export du DIP
  - "applicationId" : identifiant de l’application ayant demandé l’export du DIP
  - "objectIdentifier" : identifiant de l’objet auquel on a accédé
  - "size" : taille en octets de l’objet
  - "qualifier" : usage de l’objet
  - "version" : version de l’usage de l’objet
  - "contextId" : identifiant du contexte utilisé pour l’accès
  - "contractId" : identifiant du contrat utilisé pour l’accès
  - "archivesId" : identifiant de l’unité archivistique dont dépend le groupe d’objets contenant l’objet auquel on a accédé

Selon le paramétrage du contrat d'accès (AccessLog ACTIVE/INACTIVE), l'accès à un objet sera journalisé ou non. Par défaut, l'accès n'est pas journalisé.

Pour l'heure système en cours, ces fichiers sont présents sur les machines hébergeant le composant **storage** sous l'arborescence ``/vitam/log/storage/access-log/``.
Chaque fichier est nommé tel que :

``<tenant>_<date>_<id opération>.log``

Le `timer` systemD ``vitam-storage-accesslog-backup`` effectue la pérénisation sur offre de ces fichiers chaque heure. Dès lors, les `accesslog` sont accessibles dans des `containers` nommés ``<environnement>_<tenant>_storageaccesslog``.

Exemple en stockage filesystem pour un environnement nommé int : ``/vitam/data/offer/container/int_<tenant>_storageaccesslog/``
