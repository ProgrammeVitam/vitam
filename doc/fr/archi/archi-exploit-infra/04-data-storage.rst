.. _dataStorage:

Stockage des donn√©es
####################

.. seealso:: Cette section s'appuie fortement sur :doc:`la description de l'architecture des donn√©es </archi-applicative/11-data-architecture-multisite>`, en particulier en ce qui concerne les donn√©es d'archive.

Les offres de stockage VITAM portent la r√©f√©rence des donn√©es concernant les archives h√©berg√©es par le syst√®me VITAM : leur contenu binaire (BDO), mais √©galement les m√©tadonn√©es associ√©es au sens large (AU, GOT, journaux).

VITAM poss√®de trois impl√©mentations possibles d'offres de stockage : l'impl√©mentation bas√©e sur un syst√®me de fichiers, l'impl√©mentation Swift et l'impl√©mentation S3.

VITAM peut stocker les donn√©es dans plusieurs offres de stockage en parall√®le afin de se parer contre la perte de donn√©es. Les deux types d'offres peuvent √™tre utilis√©es seuls ou ensemble sur des offres de stockage diff√©rentes : ainsi, on peut configurer VITAM pour d√©poser les donn√©es dans 2 offres de stockage filesystem disjointes, ou dans une offre de stockage filesystem et une offre Swift, ou encore dans une offre de stockage filesystem et 2 offres Swift diff√©rentes (se basant sur 2 clusters Swift distincts) ; tout d√©pend des contraintes de non-perte de donn√©es, de scalabilit√© et de r√©silience √† la panne qui sont abord√©s dans la description des types d'offres ci-dessous.

.. note:: Un m√©canisme de resynchronisation d'une offre de stockage avec une autre, migrant de fait les donn√©es entre offres, est disponible en mode complet (la proc√©dure est d√©crite dans le :term:`DEX`). La resynchronisation partielle n'est pas support√©e dans cette version du syst√®me VITAM, mais est pr√©vue pour une future release.

.. important:: Dans le but d'assurer au maximum la p√©rennit√© des donn√©es conserv√©es dans le syst√®me VITAM, il est tr√®s fortement conseill√© de stocker les donn√©es dans au moins 2 technologies de stockage diff√©rentes (ex: 2 stockages objets de constructeurs et technologies diff√©rentes, un stockage objet et un stockage bloc, 2 stockages bloc de constructeurs et technologies diff√©rentes, ...)

Offre filesystem
================

L'offre filesystem permet de stocker les donn√©es sur un syst√®me de fichiers accessible localement par le composant "storage-offer". 

Points positifs :

* facile √† mettre en place
* facile √† exploiter
* facile √† sauvegarder

Points n√©gatifs :

* pour une offre de stockage, seule une seule instance du service storage-offer peut √™tre active √† un instant donn√©, ce qui implique que cette offre :

    - n'est pas scalable par multi-instanciation (i.e. horizontalement) ;
    - ne poss√®de pas de solution de haute disponibilit√© port√©e par la solution logicielle.

Par cons√©quent, elle est particuli√®rement adapt√©e pour les d√©ploiements de test ou de petite taille (ordre de grandeur : < 10 To), mais est √† d√©conseiller pour les d√©ploiements sur des volum√©tries importantes.

.. caution:: L'offre filesystem n√©cessite un syst√®me de fichiers acceptant les attributs √©tendus (ex: XFS) ; en particulier, il n'est donc pas possible d'h√©berger les donn√©es sur un montage NFS (NFS ne supportant pas les attributs √©tendus).


Offre Swift
===========

L'offre Swift permet de stocker les donn√©es sur un stockage objet impl√©mentant l'API Swift.

Points positifs :

* scalable : storage-offer se comporte dans ce sc√©nario comme une passerelle vers l'API Swift ; il est donc multi-instanciable au sein d'une offre de stockage.
* consomme une API normalis√©e : elle est donc compatible avec un grand nombre d'impl√©mentations diff√©rentes de Swift.

Points n√©gatifs :

* n√©cessite la mise en place et l'exploitation d'un stockage objet, ce qui est potentiellement plus complexe et moins courant que la mise √† disposition d'un simple stockage bloc ou fichier.

Par cons√©quent, elle est particuli√®rement adapt√©e pour les d√©ploiements en production de forte volum√©trie.

.. note:: Dans cette version du syst√®me VITAM, l'impl√©mentation Swift n'est en th√©orie pas oblig√©e de permettre l'upload de fichiers de taille non connue par avance (mode "chunk encoding") ; cependant, aucun test pertinent n'a pu √™tre effectu√© faute d'impl√©mentation disponible. Merci de remonter √† l'√©quipe support tout bug associ√© √† ce comportement.

.. warning:: Seules les API d'authentification keystone v1 et v3 sont aujourd'hui officiellement support√©es par la solution logicielle VITAM.


Offre S3
========

L'offre S3 permet de stocker les donn√©es sur un stockage objet impl√©mentant l'API S3.

Les points positifs et n√©gatifs sont les mmes que pour l'offre Swift.

L'offre S3 utilise le client java S3 du SDK Amazon V1. De ce fait la compatibilit√© du stockage en API S3 choise sera limit√e √† sa compatibilit√© avec le client pour pouvoir utiliser l'offre S3.
Pour que VITAM soit compatible avec l'API S3 les noms de conteneurs sont transform√©s pour obtenir des noms de bucket valids : 

* remplacement de tous les caract√®res non alphanum√©riques par des '.'
* suppression des '.' au d√©but et √† la fin
* passage de tous les caract√®res en minuscule

.. note:: Dans cette version du syst√®me VITAM, l'impl√©mentation S3 fournie par VITAM n√©cessite la taille du fichier pour l'envoyer dans le stockage S3.
