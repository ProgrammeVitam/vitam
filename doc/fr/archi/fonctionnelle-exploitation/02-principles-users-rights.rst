Utilisateurs, dossiers & droits
###############################

.. préciser les user / groupes owners, notamment concernant les besoins d'accès / de configuration / d'audit ; attention : à mettre en cohérence avec les utilsiateurs permettant le lancement / arrêt des services

Utilisateurs et groupes d'exécution
===================================

.. Préciser le principe pris : séparation des rôles admin sys et admin app et admin bdd, et les droits vus pour chacun

La segmentation des droits utilisateurs doit permettre de respecter les contraintes suivantes :

* Assurer une séparation des utilisateurs humains du système et des utilisateurs système sous lesquels tournent les process système VITAM ;
* Séparer les droits des rôles d'exploitation différents suivants :

  - Les administrateurs système (OS) ;
  - Les administrateurs technique des logiciels VITAM ;
  - Les administrateurs des bases de données VITAM.

Les utilisateurs et groupes décrits dans les paragraphes suivants doivent être ajoutés par les scripts d'installation de la solution VITAM. En outre, les règles de sudoer associées aux groupes ``vitam*-admin`` doivent également être mis en place par les scripts d'installation.


Groupes
*******

* ``vitam`` (GID : 2000) : il s'agit du groupe primaire des utilisateurs de service
* ``vitam-admin`` (GID : 3000) : il s'agit du groupe d'utilisateurs ayant les droits "sudo" permettant le le lancement des services VITAM
* ``vitamdb-admin`` (GID : 3001) : il s'agit du groupe d'utilisateurs ayant les droits "sudo" permettant le le lancement des services VITAM stockant de la donnée.


Utilisateurs
************

* utilisateur de service ; les processus VITAM tournent sous cet utilisateur. Leur login est désactivé.

   - ``vitam`` (UID : 2000) : pour les services ne stockant pas les données
   - ``vitamdb`` (UID : 2001) : pour les services stockant de la données (Ex : MongoDB et ElasticSearch)


Arborescence de fichiers
========================

Services VITAM
**************

Pour un service d'id ``<service_id>``, les fichiers et dossiers impactés par VITAM sont les suivants.

Arborescence VITAM
------------------

L'arborescence ``/vitam`` héberge les fichiers propres aux différents services ; son arborescence interne est normalisée selon le pattern suivant : ``/vitam/<folder_type>/<service_id>`` où :

* ``<service_id>`` est l'id du service auquel appartient les fichiers ;
* ``<folder-type>`` est le type de fichiers contenu par le dossier :

    - ``app``    : fichiers de ressources (non-jar) requis pour l’application (ex: .war)
    - ``bin``    : binaires (le cas échéant)
    - ``script`` : Répertoire des scripts d'exploitation du module (start/stop/status/backup)
    - ``conf``   : Fichiers de configuration
    - ``lib``    : Fichiers binaires (ex: jar)
    - ``log``    : Logs du composant
    - ``data``   : Données du composant
    - ``tmp``    : Données temporaires produites par l'application

Les droits par défaut sont les suivants :

+ Fichiers standards :

    * Owner : ``vitam`` (ou ``vitamdb``)
    * Group owner : ``vitam``
    * Droits : 0640

+ Fichiers exécutables et répertoires :

    * Owner : ``vitam`` (ou ``vitamdb``)
    * Group owner : ``vitam``
    * Droits : 0750

.. caution:: Cette arborescence ne peut contenir de caractère spéciaux ; les éléments du chemin (notamment le ``service_id``) doivent respecter l'expression régulière suivante : ``[0-9A-Za-z-_]+``

.. A faire : valider les owners et droits pour que les bons rôles puissent avoir accès aux bons dossiers, uniquement en lecture ou en lecture/écriture. Notamment : ne met-on pas vitam-admin en group owner ?

Intégration au système
----------------------

* ``/usr/lib/systemd/system/`` : répertoire racine des définitions de units systemd de type "service"

    - ``<service_id>.service`` : fichier de définition du service systemd associé au service VITAM


COTS
****

Les :term:`COTS` utilisent la même nomenclature de répertoires et utilisateurs que les services VITAM, aux exceptions suivantes :

* les fichiers binaires et bibliothèques utilisent les dossiers de l'installation du paquet natif.

