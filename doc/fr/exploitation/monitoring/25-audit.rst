Audit
#####

Divers audits mis à disposition des utilisateurs et administrateurs par le biais de l':term:`IHM` de démonstration sont décrits dans le Manuel Utilisateurs. 

Audit de cohérence
====================

.. note:: Il est recommandé de procéder à un audit de cohérence aléatoire dans le cadre d’opérations techniques ciblées, telles qu’une migration de plate-forme et de données.


Pour lancer un audit de cohérence, il faut lancer le *playbook* comme suit ::

   ansible-playbook -i <inventaire> ansible-playbok-exploitation/audit_coherence.yml --ask-vault-pass -e "access_contract=<contrat multitenant>"

Ou, si un fichier vault-password-file existe ::

    ansible-playbook -i <inventaire> ansible-playbok-exploitation/audit_coherence.yml --vault-password-file vault_pass.txt -e "access_contract=<contrat multitenant>"

.. hint:: L'audit est lancé sur tous les *tenants* ; cependant, il est nécessaire de donner le contrat d'accès adapté. Se rapprocher du métier pour cet *id* de contrat. Pour limiter la liste des *tenants*, il faut rajouter un *extra var* à la ligne de commande ansible. Exemple ::

   -e vitam_tenant_ids=[0,1]

   pour limiter aux `tenants` 0 et 1.



Audit sur les collections d'administration
====================

.. note:: cet audit permet de contrôler la présence/absence d'un référientiel ( une collection d'administration fonctionnelle ou technique ) sur les offres de stockage


Pour lancer un audit de cohérence, il faut lancer le *playbook* comme suit ::

   ansible-playbook -i <inventaire> ansible-playbok-exploitation/audit_referential.yml --ask-vault-pass -e "tenant_id=<tenant>" -e "collectionName=<nom du collection>"

Ou, si un fichier vault-password-file existe ::

   ansible-playbook -i <inventaire> ansible-playbok-exploitation/audit_referential.yml --vault-password-file vault_pass.txt -e "tenant_id=<tenant>" -e "collectionName=<nom du collection>"

.. hint:: L'audit est lancé sur un seul *tenant* et une seule *collection*. le tenant doit être le tenant d'administration dans le cas où la collections est accessible que par le tenant d'administration.