.. _systemd_timers:

Liste des `timers` systemd
##########################

.. note:: Dans les sections suivantes, les éléments de type ``<curator.log.metrics.close>`` correspondent à des variables de l'inventaire ansible utilisé.

.. seealso:: La fréquence de la plupart `timers` est modifiable (avec un comportement par défaut) ; se reporter au :term:`DIN` et à :ref:`changetimers` pour plus d'informations.

`Timers` de maintenance des index elasticsearch-log
===================================================

Ces `timers` gèrent la maintenance des index elasticsearch du cluster elasticsearch-log.

Ces `timers` sont activés sur tous les sites d'un déploiement multi-sites.


vitam-curator-metrics-indexes
-----------------------------

Maintenance des indexes ``metrics-vitam-*`` (sur elasticsearch-log) (qui contiennent les métriques remontées par les composants VITAM) :

* Ferme les indexes de plus de ``<curator.log.metrics.close>`` jours ;
* Supprime les indexes de plus de ``<curator.log.metrics.delete>`` jours.

Units systemd :

* vitam-curator-metrics-indexes.service
* vitam-curator-metrics-indexes.timer

Exécution :

* Localisation : groupe ansible ``[hosts_elasticsearch_log]`` (sur toutes les instances du groupe)
* Périodicité : Lancé chaque jour à 00:30.


vitam-curator-close-old-indexes
-------------------------------

Fermeture des anciens indexes ``logstash-*`` (sur elasticsearch-log) de plus de ``<curator.log.logstash.close>`` jours (ces indexes contiennent les logs remontés par les composants et COTS VITAM).

Units systemd :

* vitam-curator-close-old-indexes.service
* vitam-curator-close-old-indexes.timer

Exécution :

* Localisation : groupe ansible ``[hosts_elasticsearch_log]`` (sur toutes les instances du groupe)
* Périodicité : Lancé chaque jour à 00:10.


vitam-curator-delete-old-indexes
--------------------------------

Suppression des indexes ``logstash-*`` (sur elasticsearch-log) de plus de ``<curator.log.logstash.delete>`` jours (ces indexes contiennent les logs remontés par les composants et COTS VITAM).

Units systemd :

* vitam-curator-delete-old-indexes.service
* vitam-curator-delete-old-indexes.timer

Exécution :

* Localisation : groupe ansible ``[hosts_elasticsearch_log]`` (sur toutes les instances du groupe)
* Périodicité : Lancé chaque jour à 00:20.


`Timers` de gestion des journaux (preuve systémique)
====================================================

Ces `timers` gèrent la sécurisation des journaux métier :term:`VITAM`.

Ces `timers` sont activés uniquement sur le site primaire d'un déploiement multi-sites.

vitam-storage-log-traceability
------------------------------

Sécurisation des journaux d'écriture de storage.

Units systemd :

* vitam-storage-log-traceability.service
* vitam-storage-log-traceability.timer

Exécution :

* Localisation : groupe ansible ``[hosts_storage_engine]`` (sur la dernière instance du groupe uniquement)
* Périodicité : Lancé toutes les 4 heures à 40 minutes 0 secondes, par défaut.

.. _systemd_timer_trc_ope:


`Timers` de reconstruction VITAM
================================

Ces timers gèrent la reconstruction des bases de données VITAM à partir des informations persistées dans les offres de stockage.

Ces timers sont activés uniquement sur le site secondaire d'un déploiement multi-sites.


.. _systemd_timer_reconst:

vitam-metadata-reconstruction
-----------------------------

Reconstruction des données portées par le composant metadata.

Units systemd :

* vitam-metadata-reconstruction.timer
* vitam-metadata-reconstruction.service


Exécution :

* Localisation : groupe ansible ``[hosts_metadata]`` (sur la dernière instance du groupe uniquement)
* Périodicité : lancé toutes les 5 minutes, par défaut.

.. _systemd_timer_mtd_graph:

vitam-metadata-store-graph
--------------------------

`Log shipping` des données graphes portées par le composant metadata.

Units systemd :

* vitam-metadata-store-graph.timer
* vitam-metadata-store-graph.service

Exécution :

* Localisation : groupe ansible ``[hosts_metadata]`` (sur la dernière instance du groupe uniquement)
* Périodicité : lancé toutes les 30 minutes (00:10, 00:40, 01:10...), par défaut.

.. _systemd_timer_mtd_inhrtdrules:

vitam-metadata-computed-inherited-rules
---------------------------------------

Recalcul des *computedInheritedRules* pour les *units* dont les *computedInheritedRules* sont marquées comme obsolètes.

Units systemd :

* vitam-metadata-computed-inherited-rules.timer
* vitam-metadata-computed-inherited-rules.service

Exécution :

* Localisation : groupe ansible ``[hosts_metadata]`` (sur la dernière instance du groupe uniquement)
* Périodicité : lancé toutes les nuits, à 2h30, par défaut.

`Timers` techniques VITAM
=========================

vitam-metadata-purge-dip
------------------------

Nettoyage des exports DIPs expirés.

Units systemd :

* vitam-metadata-purge-dip.timer
* vitam-metadata-purge-dip.service

Exécution :

* Localisation : groupe ansible ``[hosts_metadata]`` (sur la dernière instance du groupe uniquement)
* Périodicité : Lancé chaque heure à 0 minute 0 seconde, par défaut.

vitam-metadata-purge-transfers-SIP
----------------------------------

Nettoyage des exports transfers expirés.

Units systemd :

* vitam-metadata-purge-transfers-SIP.timer
* vitam-metadata-purge-transfers-SIP.service

Exécution :

* Localisation : groupe ansible ``[hosts_metadata]`` (sur la dernière instance du groupe uniquement)
* Périodicité : lancé toutes les nuits, à 2h25, par défaut.

vitam-offer-log-compaction
--------------------------

Compaction technique des journaux des offres de stockage.

Units systemd :

* vitam-offer-log-compaction.timer
* vitam-offer-log-compaction.service

Exécution :

* Localisation : groupe ansible ``[hosts_storage_offer_default]`` (sur la dernière instance du groupe uniquement)
* Périodicité : Lancé chaque heure à 40 minutes 0 secondes, par défaut.


vitam-metadata-audit-mongodb-es
-------------------------------

Audit sur la cohérance de donées MongoDB et Elasticsearch

Units systemd :

* vitam-metadata-audit-mongodb-es.timer
* vitam-metadata-audit-mongodb-es.service

Exécution :

* Localisation : groupe ansible ``[hosts_metadata]`` (sur la dernière instance du groupe uniquement)
* Périodicité : lancé toutes les nuits, à 2h00, par défaut.

