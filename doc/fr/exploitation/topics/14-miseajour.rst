Déploiement / mises à jour
##########################

.. _CertifAnchor:

Mise à jour des certificats
===========================

Pour mettre à jour les certificats (avant expiration par exemple), il suffit de les mettre à jour dans les répertoires de déploiement, puis de régénerer les stores (dans ``environments/keystores``) et lancer leur redéploiement via cette commande ansible:

.. code-block:: bash

    # Si le mot de passe du vault n'est pas renseigné dans le fichier vault_pass.txt
    ansible-playbook ansible-vitam/vitam.yml -i environments/<fichier d'inventaire> --ask-vault-pass --tags update_vitam_certificates
    ansible-playbook ansible-vitam-extra/extra.yml -i environments/<fichier d'inventaire> --ask-vault-pass --tags update_vitam_certificates
    # Si le mot de passe du vault est renseigné dans le fichier vault_pass.txt
    ansible-playbook ansible-vitam/vitam.yml -i environments/<fichier d'inventaire> --vault-password-file vault_pass.txt --tags update_vitam_certificates
    ansible-playbook ansible-vitam-extra/extra.yml -i environments/<fichier d'inventaire> --vault-password-file vault_pass.txt --tags update_vitam_certificates

.. seealso:: Le cycle de vie des certificats est rappelé dans les annexes. Une vue d'ensemble est également présentée dans le :term:`DIN`.


Mise à jour de la solution logicielle VITAM
============================================

Pour la mise à jour de la solution logicielle :term:`VITAM` (tout comme pour sa première installation), se référer au :term:`DIN`, ainsi qu'à la "release note" associée à toute version.

Ces documents détaillent les pré-requis, la configuration des fichiers pour effectuer un déploiement. Le :term:`DIN` explique également comment valider une montée de version applicative de VITAM.

.. seealso:: Plus d'informations, et notamment les paramètres d'installation, sont disponibles dans le :term:`DIN`.

.. seealso:: Dans le cadre d'une montée de version, se référer également au Docuemnt de montée de version.

Ajouter un/des instances de composants VITAM
============================================

Dans le cas où le *sizing* initial ne donne pas pleinement satisfaction, il est possible de rajouter à une solution :term:`VITAM` existante un/des instances supplémentaires de composants.

.. caution:: Dans le cas d'ajout d'une offre, il est nécessaire de suivre la procédure de resynchronisation des offres.

.. warning:: Seul le composant "vitam-processing" n'est pas multi-instanciable.

.. warning:: Le composant "vitam-workspace" est multi-instanciable, si son répertoire ``/vitam/data/workspace`` est partagé entre les différentes instances du composant.


1. Modifier l'inventaire avec la/les VM supplémentaire(s)
2. Lancer un déploiement comme indiqué dans le :term:`DIN` en rajoutant la directive ``-l <liste de/des VM(s) supplémentaire(s)>``

