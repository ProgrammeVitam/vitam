Plan de Reprise d'Activité (PRA)
################################

Le :term:`PRA` consiste à passer un site :term:`VITAM` secondaire en site primaire après la perte d'au moins  uneoffre de stockage sur le site primaire.

Déclenchement
=============

* Vérifier que le site 1 est bien complètement arrêté
    - Il est indispensable de valider que tous les services VITAM (y compris les timers systemd) sont bien arrêtés ;
* Attendre la fin de la reconstruction au fil de l'eau sur le site secondaire
    - Le suivi de la reconstruction se fait en observant l'évolution de l'offset de reconstruction stocké dans MongoDB data.
* Pour la release 7 il faut lancer le service ``vitam-metadata-graph-builder.service`` pour recalculer les données graphe des unités archivistiques et des groupes d'objets techniques n'ayant pas encore reconstruit leurs données graphe.
* Restaurer la base identity de MongoDB data
* Reconfigurer le site secondaire en site primaire :
    - Attention à la stratégie de stockage
    - Si le site secondaire était partiellement déployé, ne pas oublier de rajouter tous les composant requis pour un fonctionnement en site primaire
    - Paramétrer la variable primary_site à true puis utiliser le playbook ``ansible-vitam/vitam.yml``

Le site secondaire est alors ouvert au service en tant que site primaire.

Retour en situation nominale
============================

.. FIXME: limitation V1

Dans cette version, le retour à la solution nominale comprenant 2 sites n'est pas supporté.
