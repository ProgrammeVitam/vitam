
.. _activation_offre:

Activation/désactivation d'une offre
####################################

Dans le cadre de la maintenance ou de la perte ponctuelle d'une offre de stockage, il peut être nécessaire de la rendre ``INACTIVE`` afin de permettre de nouveaux versements.

.. caution:: Attention, durant toute la durée d'indisponibilité d'une offre, aucune donnée ne sera écrite dessus. :term:`VITAM` ne peux pas assurer la pérénité des données si le nombre de copies attendues selon l'homologation de sécurité n'est pas atteint (>= 2). De plus, lors de la remise à ``status: ACTIVE``, il sera nécessaire de faire une resynchronisation de cette offre pour récupérer les données versées durant la durée d'indisponibilité (se référer au chapitre :doc:`40-resynchronisation`).

Pour chacune des offres de la ``vitam_strategy`` dans le fichier ``environments/group_vars/all/offers_opts.yml``, rajoutez le paramètre ``status: INACTIVE`` pour désactiver une offre (par défaut, la valeur est ``status: ACTIVE``).

Exemple pour rendre l'offre `offer-fs-2` inactive:

.. code-block:: yaml

    vitam_strategy:
        - name: offer-fs-1
          referent: true
        - name: offer-fs-2
          referent: false
          status: INACTIVE

.. caution:: En cas de désactivation d'une offre considérée référente par :term:`VITAM`, ne pas oublier de déclarer une autre offre (contenant les données) comme nouvelle référente (modifications à apporter dans ``deployment/environments/group_vars/all/offers_opts.yml`` par la directive ``referent: true``).

* Afin d'appliquer la nouvelle stratégie de stockage, il va être nécessaire de reconfigurer le composant `storage-engine`:

    .. code-block:: bash

        ansible-playbook ansible-vitam/vitam.yml -i environments/hosts.<environnement> --ask-vault-pass --limit hosts_storage_engine --tags update_vitam_configuration

.. warning:: Cette opération provoque une indisponibilité temporaire des principaux services :term:`VITAM` (versement, gestion, recherche et consultation).
