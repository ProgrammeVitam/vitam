Interruption / maintenance
##########################


Procédure d'arrêt
=================

Un *playbook* ansible d'arrêt complet de la solution logicielle :term:`VITAM` est fourni, sous ``deployment/ansible-vitam-exploitation``  (fichier de *playbook* ``stop_vitam.yml``), pour réaliser de façon automatisée les actions nécessaires.

.. warning:: Ce script, en l'état, permet un `EMERGENCY BREAK`, autrement dit un arrêt brutal des composants, ne permettant pas de garantir, à l'issue, une cohérence  des données.

.. note:: Une confirmation est demandée pour lancer ce script d'arrêt de la solution logicielle VITAM.

.. FIXME: limitation V1

.. warning:: Dans la version actuelle, il est fortement recommandé de positionner les traitements courants en pause avant de lancer la procédure d'arrêt.

Un playbook ansible d'arrêt des `timers` systemD :term:`VITAM` est également fourni, sous ``deployment/ansible-vitam-exploitation``  (fichier de *playbook* ``stop_vitam_timers.yml``), pour réaliser de façon automatisée les actions nécessaires. Ce script est à lancer une fois l'arrêt des services correctement réalisé.



Procédure de démarrage
======================

Le pré-requis est le bon fonctionnement des partitions hébergeant la solution logicielle :term:`VITAM`.

Un *playbook* ansible de démarrage de la solution logicielle :term:`VITAM` est fourni, sous ``deployment/ansible-vitam-exploitation`` (fichier de *playbook* ``start_vitam.yml``), pour réaliser de façon automatisée les actions nécessaires.

Un playbook ansible dd démarrage des `timers` systemD :term:`VITAM` est également fourni, sous ``deployment/ansible-vitam-exploitation``  (fichier de *playbook* ``start_vitam_timers.yml``), pour réaliser de façon automatisée les actions nécessaires. Ce script est à lancer une fois le démarrage des services correctement réalisé.

Procédure de statut
===================

Un playbook ansible de démarrage de VITAM est fourni, sous ``deployment/ansible-vitam-exploitation`` (fichier de *playbook* ``status_vitam.yml``), pour réaliser de façon automatisée les tests "autotest" intégérés dans la solution logicielle :term:`VITAM`.


Procédure de maintenance / indisponibilité de VITAM
===================================================

Deux `playbooks` sont fournis dans ``deployment/ansible-vitam-exploitation`` :

- fichier de *playbook* ``stop_external.yml``, permettant d'arrêter sélectivement les composants :term:`VITAM` **ingest-external** et **access-external**
- fichier de *playbook* ``start_external.yml``, permettant de démarrer sélectivement :term:`VITAM` **ingest-external** et **access-external**

Ces scripts permettent d'empêcher l'usage de VITAM par les services versants, tout en laissant opérationnel le reste de la solution logicielle. Ces `playbooks` peuvent être utiles, voire nécessaires, dans le cadre d'une migration de données ou de maintenance de :term:`VITAM`.


Procédure de maintenance liée aux `timers systemD`
==================================================

Deux `playbooks` sont fournis dans ``deployment/ansible-vitam-exploitation`` :

- fichier de *playbook* ``stop_vitam_timers.yml``, permettant d'arrêter sélectivement les `timers systemD`
- fichier de *playbook* ``start_vitam_timers.yml``, permettant de démarrer sélectivement les `timers systemD`

Procédure de maintenance sur les composants d'administration
=============================================================

Deux `playbooks` sont fournis dans ``deployment/ansible-vitam-exploitation`` :

- fichier de *playbook* ``stop_vitam_admin.yml``, permettent d'arrêter sélectivement les composants Consul, la chaine de log (logstash / cluster elasticsearch log / kibana-log), cerebro et les docker mongo-express et elasticsearch-head
- fichier de *playbook* ``start_vitam_admin.yml``, permettent de démarrer sélectivement les composants Consul, la chaine de log (logstash / cluster elasticsearch log / kibana-log), cerebro et les docker mongo-express et elasticsearch-head

.. warning:: En passant le *playbook* d'arrêt, l'ensemble de la solution logicielle :term:`VITAM` devient inutilisable.

Procédure de maintenance des `IHM`
==================================

Deux `playbooks` sont fournis dans ``deployment/ansible-vitam-exploitation`` :

- fichier de *playbook* ``stop_vitam_ihm.yml``, permettent d'arrêter sélectivement les composants :term:`VITAM` :term:`IHM` ihm-demo et ihm-recette
- fichier de *playbook* ``start_vitam_ihm.yml``, permettent de démarrer sélectivement les composants :term:`VITAM` :term:`IHM` ihm-demo et ihm-recette

Procédure de maintenance des `Bases de données métier`
======================================================

Quatre `playbooks` sont fournis dans ``deployment/ansible-vitam-exploitation`` :

- fichier de *playbook* ``start_elasticsearch_data.yml``, permettent de démarrer la totalité des composants mongodb
- fichier de *playbook* ``start_mongodb.yml``, permettent de démarrer les composants elasticsearch-data
- fichier de *playbook* ``stop_elasticsearch_data.yml``, permettent d'arrêter la totalité des composants mongodb
- fichier de *playbook* ``stop_mongodb.yml``, permettent d'arrêter les composants elasticsearch-data
