.. _dip_cleanup:

Suppression des DIP et des fichiers de transfert
################################################

Les DIP générés dans le cadre d’une demande de communication et les SIP générés dans le cadre d’une demande de transfert sont stockés dans des dossiers spécifiques.

Ils sont purgés automatiquement à l’expiration d’un délai paramétrable par l’administrateur technique.

Par défaut, la solution logicielle Vitam retient les DIP durant 7 jours si l'espace libre du workspace représente plus de 25% de la taille totale du workspace et durant 1 jour si ce dernier représente moins de 25% de la taille totale du workspace, quel que soit leur type, et les efface au moyen d’un batch qui est lancé chaque heure à 0 minute 0 seconde.

Cette configuration par défaut peut être modifiée lors du paramétrage initial de la plate-forme par les administrateurs – fonctionnel pour la définition du besoin et technique pour la saisie réelle des informations – de chaque implémentation de la solution logicielle Vitam et définit, pour tous les tenants et pour chaque type de DIP – DIP générés dans le cadre d’une demande de communication et SIP générés dans le cadre d’une demande de transfert – la durée de rétention dans l’espace de stockage et la fréquence du batch permettant de les purger du système.

Le fichier de configuration (``deployment/environments/group_vars/all/vitam_vars.yml``) se présente comme suit (paramétrage par défaut) :

.. code-block:: yaml

    ### global ###
    [...]
    vitam_timers:
    [...]
        metadata:
            [...]
            - name: vitam-metadata-purge-dip
              frequency: "*-*-* *:00:00"
            - name: vitam-metadata-purge-transfers-SIP
              frequency: "*-*-* 02:25:00"
    ### Composants Vitam ###
    vitam:
        [...]
        metadata :
         [...]
         # DIP cleanup delay (in minutes)
            dipTimeToLiveInMinutes: 10080 # 7 days
            criticalDipTimeToLiveInMinutes: 1440 # 1 day
            transfersSIPTimeToLiveInMinutes: 10080 # 7 days
            workspaceFreespaceThreshold: 25 # when below use critical time to live when above use normal time to live


.. note::
    Veuillez vous référer aux documents d'architecture (chapitre 5.13.2 "Stockage") et d'installation (chapitre 4.2.5.12 "Fichiers complémentaires") pour obtenir plus d'informations sur le stockage dans la solution :term:`Vitam`
