Intégration d'une application externe dans Vitam
################################################

Prérequis
=========

L'application externe devra être en mesure de requêter les composants ingest-external & access-external sur leur port de service par protocole HTTPS.
Il faut donc une ouverture de flux réseau pour le protocole TCP ou TLS, selon l'infrastructure en place, sur les ports de service de ces deux composants Vitam.

Il est nécessaire de créer un certificat TLS client pour l'application externe, le certificat publique devra bien entendu être intégré dans le granted-store des composants ingest-external & access-external.
La chaine de certification complète de ce certificat devra aussi être ajoutée dans le truststore de ces composants.

Intégration du certificat client de l'application externe
=========================================================

Vitam fournit une arborescence de répertoire permettant d'ajouter automatiquement le certificat client ainsi que la chaîne de certification dans les bons keystores.

* Déposer les certificats de chaine de certification dans `environments/certs/client-external/ca`
* Déposer le certificat client de l'application dans `environments/certs/client-external/clients/external`
* Editer le fichier ``environments/group_vars/all/vitam_security.yml`` et ajouter le(s) entrée(s) supplémentaire(s)  (sous forme répertoire/fichier.crt)
dans  la directive ``admin_context_certs``

.. Warning:: Bien vérifier qu'aucun certificat ou CA non souhaité ne soit présent dans `environments/certs/*`

.. seealso:: Ensuite, si ce n'est pas déjà fait, il reste à positionner les autres certificats, puis générer les keystores. Pour cela, se référer au :term:`DIN`, chapitre concernant la gestion des certificats.


Déploiement des keystores
=========================

Vitam n'est pas encore déployé
------------------------------

Déployer Vitam en suivant la procédure indiquée dans le :term:`DIN`.

Vitam est déjà déployé
----------------------

Suivre la procédure de la section :ref:`CertifAnchor`.
