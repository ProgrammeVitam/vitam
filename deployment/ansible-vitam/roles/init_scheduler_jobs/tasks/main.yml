---

- name: "Wait until scheduler service is up"
  wait_for:
    host: "{{ hostvars[groups['hosts_scheduler'][0]]['ip_admin'] }}"
    port: "{{ vitam.scheduler.port_service }}"
    timeout: "{{ vitam_defaults.services.start_timeout }}"
  run_once: true
  tags: update_vitam_configuration

- name: initiate scheduler jobs
  uri:
    url: "http://{{ hostvars[groups['hosts_scheduler'][0]]['ip_admin'] }}:{{ vitam.scheduler.port_admin }}/scheduler/v1/jobs"
    method: POST
    headers:
      Connection: "keep-alive"
      Host: "{{ vitam_struct.host }}"
    status_code: 202
  run_once: true
  tags: update_vitam_configuration