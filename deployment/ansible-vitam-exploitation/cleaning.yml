---
# Doc: http://www.programmevitam.fr/ressources/DocCourante/html/exploitation/topics/90-environment-cleaning.html

# Confirm launching this playbook
- hosts: localhost
  any_errors_fatal: yes
  gather_facts: no
  vars_prompt:
    name: "confirmation"
    prompt: "/!\\ WARNING : This playbook will cleanup your Vitam instance; IT WILL ERASE ALL YOUR DATA ! It must not be applied on Production.\n\nAre you sure you want to run this playbook ?\nAnswer with 'YES'"
    default: "NO"
    private: no
  tasks:
    - name: Check Confirmation
      fail: msg="Playbook run confirmation failed"
      when: confirmation|upper != "YES"

- import_playbook: stop_external.yml

- import_playbook: stop_vitam_scheduling.yml

- hosts: hosts_mongos_data
  roles:
    - cleaning_mongo_DB

- hosts: hosts_functional_administration
  roles:
    - cleaning_reindex

- hosts: hosts_mongos_offer
  roles:
    - cleaning_mongo_DB_offer

- hosts: hosts_storage_offer_default
  roles:
    - cleaning_offers
  vars:
      vitam_struct: "{{ vitam.storageofferdefault }}"

- hosts: hosts_workspace
  roles:
    - cleaning_workspace
  vars:
      vitam_struct: "{{ vitam.workspace }}"

- import_playbook: start_external.yml

- import_playbook: start_vitam_scheduling.yml
