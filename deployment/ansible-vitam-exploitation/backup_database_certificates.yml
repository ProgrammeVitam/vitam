---
# Doc: http://www.programmevitam.fr/ressources/DocCourante/html/exploitation/topics/16-backup_restore.html#cas-de-la-base-mongo-certificates

# Confirm launching this playbook
- hosts: localhost
  any_errors_fatal: yes
  gather_facts: no
  vars_prompt:
    name: "confirmation"
    prompt: "This playbook will take a backup of the identity collection on first mongo-data under the directory /vitam/backup/mongod\n\nAre you sure you want to run this playbook ?\nAnswer with 'YES'"
    default: "NO"
    private: no
  tasks:
    - name: Check Confirmation
      fail: msg="Playbook run confirmation failed"
      when: confirmation|upper != "YES"

- hosts: hosts_mongod_data
  roles:
    - backup_mongo_database
  vars:
    database: "identity"
    authentication: "{{ mongodb['mongo-data'].securityInternal }}"
