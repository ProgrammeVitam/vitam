---

- name: init troubleshoot directories
  file:
    path: "{{ inventory_dir }}/troubleshoot/{{ inventory_hostname }}/"
    state: directory
    mode: 0777
  delegate_to: localhost

# If sync_type == 'rsync'
- block:

  - name: ensure rsync package is installed for synchronize module
    package:
      name: rsync
      state: present
    register: result
    retries: "{{ packages_install_retries_number }}"
    until: result is succeeded
    delay: "{{ packages_install_retries_delay }}"

  - name: ensure rsync is installed locally for synchronize module
    package:
      name: rsync
      state: present
    register: result
    retries: "{{ packages_install_retries_number }}"
    until: result is succeeded
    delay: "{{ packages_install_retries_delay }}"
    run_once: true
    delegate_to: localhost

  when: sync_type | default('fetch') | lower == 'rsync'
