---

- name: Populate service facts
  service_facts:

- name: "service {{ service_name }} {{ service_state }}"
  service:
    name: "{{ service_name }}"
    state: "{{ service_state }}"
  when: service_name + '.service' in ansible_facts.services

- name: "Wait until service {{ service_name }} is {{ service_state }} : check port {{ service_port }}"
  wait_for:
    host: "{{ service_host }}"
    port: "{{ service_port }}"
    state: "{{ service_state }}"
    timeout: "{{ service_timeout }}"
  when: service_port is defined and service_name + '.service' in ansible_facts.services
