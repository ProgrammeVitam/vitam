---

- name: get consul state
  uri:
    url: http://{{ ip_admin }}:8500/v1/health/state/any
    return_content: true
  register: consul_state
  run_once: true

- name: save current state in {{ inventory_dir }}
  delegate_to: localhost
  copy:
    content: "{{ consul_state }}"
    dest: "{{ inventory_dir }}/troubleshoot/consul_state.json"
  run_once: true
