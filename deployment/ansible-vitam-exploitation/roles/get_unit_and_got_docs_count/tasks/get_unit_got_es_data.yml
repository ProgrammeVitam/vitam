---

- name: Get elasticsearch-data Unit & ObjectGroup indexes
  uri:
    url: "http://{{ elasticsearch.data.host }}:{{ elasticsearch.data.port_http }}/_cat/indices/unit_*,objectgroup_*?h=index,docs.count&s=index"
    method: GET
    return_content: yes
  register: out

- set_fact:
    unit_got_doc_count_elastic_data: "{{ out.content.split('\n') }}"

- block:

  - name: Write header to result file
    lineinfile:
      line: "## Elasticsearch-data Unit and ObjectGroup Doc count on {{ 'reference' if primary_site | lower == 'true' else 'reconstruction' }} site"
      path: "{{ report_file }}"
      create: true

  - name: Write output to result file
    lineinfile:
      line: "{{ item }}"
      path: "{{ report_file }}"
    when: item != ''
    with_items: "{{ unit_got_doc_count_elastic_data }}"

  delegate_to: localhost
