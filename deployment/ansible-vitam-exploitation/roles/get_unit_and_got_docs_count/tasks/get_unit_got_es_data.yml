---

- name: Get elasticsearch data Unit indexes
  uri:
    url: "http://{{ elasticsearch.data.host }}:{{ elasticsearch.data.port_http }}/_cat/indices/unit_*?h=index,docs.count"
    method: GET
    return_content: yes
  register: es_data_unit_indexes

- set_fact:
    es_data_unit_indexes: "{{ es_data_unit_indexes.content.split('\n') }}"

- name: Get elasticsearch data ObjectGroup indexes
  uri:
    url: "http://{{ elasticsearch.data.host }}:{{ elasticsearch.data.port_http }}/_cat/indices/objectgroup_*?h=index,docs.count"
    method: GET
    return_content: yes
  register: es_data_got_indexes

- set_fact:
    es_data_got_indexes: "{{ es_data_got_indexes.content.split('\n') }}"

- set_fact:
    unit_got_doc_count_es_data: "{{ es_data_unit_indexes + es_data_got_indexes | sort() }}"

- name: Write header to result file
  local_action:
    module: lineinfile
    line: "## Elasticsearch-data Unit and Object Group Doc count"
    path: "{{ inventory_dir }}/{{ report_filename }}"

- name: write to result file
  local_action:
    module: lineinfile
    line: "{{ item }}"
    path: "{{ inventory_dir }}/{{ report_filename}}"
  with_items: "{{ unit_got_doc_count_es_data }}"

