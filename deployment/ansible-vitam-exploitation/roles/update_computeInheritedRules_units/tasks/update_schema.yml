---

- name: copy temporary script to update unit schema with computedInheritedRules
  template:
    src: "update_computeInheritedRules_units.js.j2"
    dest: "{{ vitam_defaults.folder.root_path }}/tmp/mongos/update_computeInheritedRules_units.js"
    owner: "{{ vitam_defaults.users.vitamdb }}"
    group: "{{ vitam_defaults.users.group }}"
    mode: "{{ vitam_defaults.folder.conf_permission }}"
  delegate_to: "{{ groups['hosts_mongos_data'] | first }}"

- name: update unit schema in mongo.
  shell: "mongo {{ hostvars[groups['hosts_mongos_data'][0]]['ip_service'] }}:{{ mongodb.mongos_port }}/admin -u {{ mongodb['mongo-data'].admin.user }} -p {{ mongodb['mongo-data'].admin.password }} --quiet {{ vitam_defaults.folder.root_path }}/tmp/mongos/update_computeInheritedRules_units.js"
  delegate_to: "{{ groups['hosts_mongos_data'] | first }}"

- name: remove temporary script.
  file:
    path: "{{ vitam_defaults.folder.root_path }}/tmp/mongos/update_computeInheritedRules_units.js"
    state: absent
  delegate_to: "{{ groups['hosts_mongos_data'] | first }}"
  run_once: true
