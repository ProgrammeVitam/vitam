---

- set_fact:
    admin_context_found: 0
    security_profile_to_delete: "{{ security_profile_id }}"

- name: Message
  debug:
    msg: "You are going to delete the following security profile(s) with the related informations {{'only ['+security_profile_to_delete+']' if security_profile_to_delete|string|length > 0 else 'all'}}:"

- import_tasks: "check_params_consistency.yml"

- set_fact:
    sp_found: "{{ item }}"
  when: security_profile_to_delete is defined and item.name in security_profile_to_delete
  with_items: "{{ vitam_additional_securityprofiles }}"

- name: Compute security profiles to delete
  set_fact:
    security_profiles_to_delete: "{{ [ sp_found ] if sp_found is defined and sp_found|length > 0 else vitam_additional_securityprofiles }}"

- name: Prompt confirmation
  pause:
    prompt: "Are you sure you want to execute this action ?\nAnswer with 'YES'"
  register: delete_contexts_confirmation
  delegate_to: localhost
  when: confirmation|upper != "YES"

- set_fact:
    delete_contexts_confirmation:
      user_input: "YES"
  when: confirmation|upper == "YES"

- include_tasks: delete_security_profile.yml
  loop: "{{ security_profiles_to_delete }}"
  loop_control:
    loop_var: security_profile
  when: delete_contexts_confirmation.user_input == "YES"
