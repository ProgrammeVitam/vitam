---

- set_fact:
    security_profile_to_update: "{{ security_profile_id }}"

- fail:
    msg: "The security profile to update should be provided in the playbook command. Add -e security_profile_id=<your-sp-to-update> to your command."
  when: security_profile_to_update|length == 0

- name: Message
  debug:
    msg: "You are going to update the following security profile(s) with the related informations {{'only ['+security_profile_to_update+']' if security_profile_to_update|string|length > 0 else ''}}:"

- import_tasks: "check_params_consistency.yml"

- name: "confirmation"
  pause:
    prompt: "Are you sure you want to execute this action ?\nAnswer with 'YES'"
    echo: YES
  register: exec_action
  delegate_to: localhost

- set_fact:
    sp_found: "{{ item }}"
  when: security_profile_to_update is defined and item.name in security_profile_to_update
  with_items: "{{ vitam_additional_securityprofiles }}"

- name: Compute security profile to update
  set_fact:
    security_profiles_to_update: "{{ [ sp_found ] if sp_found is defined and sp_found|length > 0 else '' }}"

- include_tasks: update_security_profile.yml
  loop: "{{ security_profiles_to_update }}"
  when: exec_action.user_input == "YES" and security_profiles_to_update|length > 0
