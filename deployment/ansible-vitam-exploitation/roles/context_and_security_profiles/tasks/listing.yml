---

- debug:
    msg: "Show certificates content"
  when: showEncodedCertificate is defined and showEncodedCertificate=="true"

#- debug:
#    msg: "Show only info for selected security profile id"
#  when: security_profile_id is defined and security_profile_id|length > 0

- name: Copy temporary script to list embedded data from collections SecurityProfile, Context and Certificate
  template:
    src: "listing_securityProfiles_contexts_certificates.js.j2"
    dest: "{{ vitam_defaults.folder.root_path }}/tmp/mongos/listing_securityProfiles_contexts_certificates.js"
    owner: "{{ vitam_defaults.users.vitamdb }}"
    group: "{{ vitam_defaults.users.group }}"
    mode: "{{ vitam_defaults.folder.conf_permission }}"

- name: Get listing
  shell: "mongo {{ ip_service }}:{{ mongodb.mongos_port }}/admin -u {{ mongodb['mongo-data'].admin.user }} -p {{ mongodb['mongo-data'].admin.password }} --quiet {{ vitam_defaults.folder.root_path }}/tmp/mongos/listing_securityProfiles_contexts_certificates.js"
  register: listing_results
  no_log: "{{ hide_passwords_during_deploy }}"

- set_fact:
    current_state_vitam_database: "{{ listing_results.stdout }}"

- debug:
    var: current_state_vitam_database

- name: Remove temporary script.
  file:
    path: "{{ vitam_defaults.folder.root_path }}/tmp/mongos/listing_securityProfiles_contexts_certificates_hierarchy.js"
    state: absent
  run_once: true
