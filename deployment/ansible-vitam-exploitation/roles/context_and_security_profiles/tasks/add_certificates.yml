---

- name: Upload context certificates into security-internal
  uri:
    method: POST
    body: "{ \"contextId\" : \"{{ context.identifier }}\" , \"certificate\" : \"{{ lookup('file','{{inventory_dir}}/certs/client-external/clients/{{ item }}') | b64encode }}\" }"
    status_code: 201
    timeout: "{{ vitam_defaults.services.api_call_timeout }}"
    url: http://{{ hostvars[groups['hosts_security_internal'][0]]['ip_admin'] }}:{{ vitam.security_internal.port_admin }}/v1/api/identity
    body_format: "json"
  run_once: true
  loop: "{{ context.certificates }}"
