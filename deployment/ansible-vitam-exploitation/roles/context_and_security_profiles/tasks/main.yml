---

- block:

  - name: "Wait until service functional-admin is up"
    wait_for:
      host: "{{ hostvars[groups['hosts_functional_administration'][0]]['ip_admin'] }}"
      port: "{{ vitam.functional_administration.port_admin }}"
      state: "started"
      timeout: "{{ vitam_defaults.services.start_timeout }}"
    run_once: true

  - import_tasks: check_elasticsearch.yml

  when: action_ctx != "list"

- include_tasks: listing.yml
  when: action_ctx == "list"

- include_tasks: add.yml
  when: action_ctx == "add"

- include_tasks: delete.yml
  when: action_ctx == "delete"

- include_tasks: update.yml
  when: action_ctx == "update"
