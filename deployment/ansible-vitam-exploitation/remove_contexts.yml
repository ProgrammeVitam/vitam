---
- hosts: all
  any_errors_fatal: yes
  vars_prompt:
    name: "confirmation"
    prompt: "Are you sure you want to run this playbook to only remove contexts and security profiles with associated resources ? Answer with 'YES'"
    default: "NO"
    private: no
  tasks:
    - name: Check Confirmation
      fail: msg="Playbook run confirmation failed"
      when: confirmation|upper != "YES"

- hosts: hosts_security_internal
  any_errors_fatal: true
  roles:
    - { role: remove_context_and_security_profiles, when: primary_site | lower == "true", serial: 1}
  vars:
    vitam_struct: "{{ vitam.security_internal }}"