---
# Example: ansible-vitam-exploitation/diff_offers.yml -e "confirmation=YES offer1=offer-fs-1.service.prod-dc1.consul offer2=offer-fs-2.service.prod-dc2.consul tenants=0,1,2 containers=units,objects,objectgroups,logbooks,reports,manifests,profiles,storagelog,storageaccesslog,storagetraceability,rules,dip,agencies,backup,backupoperations,unitgraph,objectgroupgraph,distributionreports,accessionregistersdetail,accessionregisterssymbolic,tmp,archivaltransferreply"
# Doc: http://www.programmevitam.fr/ressources/DocCourante/html/exploitation/topics/45-offerdiff.html

# Confirm launching this playbook
- hosts: localhost
  gather_facts: no
  any_errors_fatal: yes
  vars_prompt:
    name: "confirmation"
    prompt: "This playbook will execute a check between two offers on the selected tenants & containers.\n/!\\ WARNING : This execution will use disk space on the first hosts_storage_engine.\nThe execution may take time depending of the amount of data to compare.\n\nAre you sure you want to run this playbook?\nAnswer with 'YES' / 'NO'"
    default: "NO"
    private: no
  tasks:
    - name: Check Confirmation
      fail: msg="Playbook run confirmation failed"
      when: confirmation|upper != "YES"
      tags: always

- hosts: hosts_storage_engine
  any_errors_fatal: yes
  gather_facts: no
  run_once: true
  roles:
    - diff_offers
  vars:
    vitam_struct: "{{ vitam.storageengine }}"
